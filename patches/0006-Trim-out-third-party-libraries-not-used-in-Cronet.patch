From 16231de0a74a30c291c7a52d226c98568f2a1364 Mon Sep 17 00:00:00 2001
From: Mohannad Farrag <aymanm@google.com>
Date: Fri, 3 Feb 2023 15:19:00 +0000
Subject: [PATCH] Trim out third-party libraries not used in Cronet

A bunch of third-party libraries in base aren't used for Android. So I thought it'd be a good idea to trim them out for cronet builds.

The identified libraries are the following:
  * xdg_mime: This cant exist in AOSP due to licensing issues.
  * xdg_user_dir: This is not used in Android at all but being built when we're building different targets for host.
  * symbolize: This is not used in Android at all but being built when we're building different targets for host.

Bug: 1412771
---
 base/BUILD.gn | 31 ++++++++++++++++---------------
 1 file changed, 16 insertions(+), 15 deletions(-)

diff --git a/base/BUILD.gn b/base/BUILD.gn
index 1cb7a80705f9f..3685b5cc9743f 100644
--- a/base/BUILD.gn
+++ b/base/BUILD.gn
@@ -2185,24 +2185,25 @@ component("base") {
 
     configs += linux_configs
     all_dependent_configs += linux_configs
-
     sources += [
-      "nix/mime_util_xdg.cc",
-      "nix/mime_util_xdg.h",
-      "nix/xdg_util.cc",
-      "nix/xdg_util.h",
       "system/sys_info_linux.cc",
     ]
-
-    defines += [ "USE_SYMBOLIZE" ]
-
-    # These dependencies are not required on Android, and in the case
-    # of xdg_mime must be excluded due to licensing restrictions.
-    deps += [
-      "//base/third_party/symbolize",
-      "//base/third_party/xdg_mime",
-      "//base/third_party/xdg_user_dirs",
-    ]
+    if (!is_cronet_build) {
+      # These dependencies are not required on Android, and in the case
+      # of xdg_mime must be excluded due to licensing restrictions.
+      sources += [
+        "nix/mime_util_xdg.cc",
+        "nix/mime_util_xdg.h",
+        "nix/xdg_util.cc",
+        "nix/xdg_util.h",
+      ]
+      defines += [ "USE_SYMBOLIZE" ]
+      deps += [
+        "//base/third_party/symbolize",
+        "//base/third_party/xdg_mime",
+        "//base/third_party/xdg_user_dirs",
+      ]
+    }
   } else {
     if (!is_android) {
       sources -= [
-- 
2.40.0.348.gf938b09366-goog

