From 9312fb191e5d4cb017264bc08a788a7daf1bf71a Mon Sep 17 00:00:00 2001
From: My Name <colibie@google.com>
Date: Tue, 31 Jan 2023 21:50:19 +0000
Subject: [PATCH] Switch to androidx's AndroidJUnit4 runner

aosp migrated from android.support to androidx
test runner. Will patch this upstream too.

Test: atest NetHttpTests
Bug: 267353182
Change-Id: I94da111c4a5fe69ef36683f0f97279e91a806e76
---
 components/cronet/android/BUILD.gn | 77 +++++++++++++++---------------
 1 file changed, 38 insertions(+), 39 deletions(-)

diff --git a/components/cronet/android/BUILD.gn b/components/cronet/android/BUILD.gn
index 444c63de7a41a..bedd09bd84744 100644
--- a/components/cronet/android/BUILD.gn
+++ b/components/cronet/android/BUILD.gn
@@ -956,6 +956,12 @@ if (!is_component_build) {
                                            "test/smoketests/src/org/chromium/net/smoke/NativeCronetTestRule.java",
                                          ]
 
+  cronet_tests_androidx_common_srcs = [
+    "//third_party/androidx:androidx_test_core_java",
+    "//third_party/androidx:androidx_test_ext_junit_java",
+    "//third_party/androidx:androidx_test_runner_java",
+  ]
+
   # cronet_common_javatests.jar - Cronet Java test common files.
   android_library("cronet_common_javatests") {
     testonly = true
@@ -966,16 +972,15 @@ if (!is_component_build) {
       "test/javatests/src/org/chromium/net/TestUrlRequestCallback.java",
     ]
     deps = [
-      ":cronet_api_java",
-      ":cronet_impl_all_java",
-      "//base:base_java",
-      "//base:jni_java",
-      "//build/android:build_java",
-      "//third_party/android_sdk:android_test_base_java",
-      "//third_party/android_support_test_runner:runner_java",
-      "//third_party/androidx:androidx_annotation_annotation_java",
-      "//third_party/junit",
-    ]
+             ":cronet_api_java",
+             ":cronet_impl_all_java",
+             "//base:base_java",
+             "//base:jni_java",
+             "//build/android:build_java",
+             "//third_party/android_sdk:android_test_base_java",
+             "//third_party/androidx:androidx_annotation_annotation_java",
+             "//third_party/junit",
+            ] + cronet_tests_androidx_common_srcs
   }
 
   # cronet_fake_javatests.jar - Java tests for the fake implementation of Cronet.
@@ -1074,7 +1079,7 @@ if (!is_component_build) {
       ":cronet_impl_all_java",
       ":cronet_urlconnection_impl_java",
       "//third_party/android_sdk:android_test_base_java",
-      "//third_party/android_support_test_runner:runner_java",
+      "//third_party/androidx:androidx_test_ext_junit_java",
       "//third_party/androidx:androidx_test_runner_java",
       "//third_party/google-truth:google_truth_java",
       "//third_party/hamcrest:hamcrest_core_java",
@@ -1110,27 +1115,26 @@ if (!is_component_build) {
               ]
 
     deps = [
-      ":cronet_api_java",
-      ":cronet_combine_proguard_flags",
-      ":cronet_impl_all_java",
-      ":cronet_javatests",
-      ":cronet_test_apk_java",
-      ":cronet_test_apk_resources",
-      "//base:base_java",
-      "//base:base_java_test_support",
-      "//base:jni_java",
-      "//build/android:build_java",
-      "//net/android:net_java",
-      "//net/android:net_java_test_support",
-      "//third_party/android_sdk:android_test_base_java",
-      "//third_party/android_sdk:android_test_mock_java",
-      "//third_party/android_support_test_runner:runner_java",
-      "//third_party/androidx:androidx_test_runner_java",
-      "//third_party/hamcrest:hamcrest_core_java",
-      "//third_party/junit",
-      "//third_party/netty-tcnative:netty-tcnative-so",
-      "//third_party/netty4:netty_all_java",
-    ]
+             ":cronet_api_java",
+             ":cronet_combine_proguard_flags",
+             ":cronet_impl_all_java",
+             ":cronet_javatests",
+             ":cronet_test_apk_java",
+             ":cronet_test_apk_resources",
+             "//base:base_java",
+             "//base:base_java_test_support",
+             "//base:jni_java",
+             "//build/android:build_java",
+             "//net/android:net_java",
+             "//net/android:net_java_test_support",
+             "//third_party/android_sdk:android_test_base_java",
+             "//third_party/android_sdk:android_test_mock_java",
+             "//third_party/hamcrest:hamcrest_core_java",
+             "//third_party/junit",
+             "//third_party/netty-tcnative:netty-tcnative-so",
+             "//third_party/netty4:netty_all_java",
+           ] + cronet_tests_androidx_common_srcs
+
     additional_apks = [ "//net/android:net_test_support_apk" ]
 
     data_deps = [ "//net:test_support" ]
@@ -1174,12 +1178,9 @@ if (!is_component_build) {
       "//base:base_java_test_support",
       "//third_party/android_sdk:android_test_base_java",
       "//third_party/android_sdk:android_test_mock_java",
-      "//third_party/android_support_test_runner:runner_java",
-      "//third_party/androidx:androidx_multidex_multidex_java",
-      "//third_party/androidx:androidx_test_runner_java",
       "//third_party/junit",
       "//third_party/netty4:netty_all_java",
-    ]
+    ] + cronet_tests_androidx_common_srcs
 
     if (!is_java_debug) {
       proguard_enabled = true
@@ -1211,11 +1212,9 @@ if (!is_component_build) {
       "//build/android:build_java",
       "//third_party/android_sdk:android_test_base_java",
       "//third_party/android_sdk:android_test_mock_java",
-      "//third_party/android_support_test_runner:runner_java",
-      "//third_party/androidx:androidx_test_runner_java",
       "//third_party/junit",
       "//third_party/netty4:netty_all_java",
-    ]
+    ] + cronet_tests_androidx_common_srcs
 
     enable_multidex = true
     if (!is_java_debug) {
-- 
2.40.0.348.gf938b09366-goog

